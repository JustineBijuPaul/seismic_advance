{% extends "base.html" %}

{% block title %}{{ phase.title() }} Earthquake Tutorial{% endblock %}

{% block extra_css %}
<style>
    .step-card {
        margin-bottom: 2rem;
        border: none;
        border-radius: 15px;
    }

    .step-content {
        padding: 2rem;
    }

    .step-media {
        border-radius: 15px;
        overflow: hidden;
        margin-bottom: 1rem;
    }

    .step-nav {
        position: sticky;
        top: 20px;
    }

    .progress-indicator {
        height: 5px;
        background: #eee;
        margin-bottom: 2rem;
    }

    .progress-bar {
        height: 100%;
        background: var(--gradient-primary);
        transition: width 0.3s ease;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="progress-indicator">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <div class="row">
        <div class="col-md-3">
            <div class="step-nav">
                <div class="list-group">
                    {% for step in steps %}
                    <a href="#step-{{ loop.index }}" class="list-group-item list-group-item-action">
                        {{ step.title }}
                    </a>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="col-md-9">
            {% for step in steps %}
            <div class="card step-card" id="step-{{ loop.index }}">
                <div class="step-content">
                    <h3>{{ step.title }}</h3>
                    
                    {% if step.video_url %}
                    <div class="step-media">
                        <video controls class="w-100">
                            <source src="{{ step.video_url }}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                    {% elif step.image_url %}
                    <div class="step-media">
                        <img src="{{ step.image_url }}" alt="{{ step.title }}" class="w-100">
                    </div>
                    {% endif %}

                    <div class="step-text">
                        {{ step.content }}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const progressBar = document.getElementById('progressBar');
    const steps = document.querySelectorAll('.step-card');
    
    // Update progress bar based on scroll position
    window.addEventListener('scroll', () => {
        const scrolled = window.scrollY;
        const total = document.documentElement.scrollHeight - window.innerHeight;
        const progress = (scrolled / total) * 100;
        progressBar.style.width = `${progress}%`;
    });

    // Smooth scroll to steps
    document.querySelectorAll('.step-nav a').forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const targetId = link.getAttribute('href');
            document.querySelector(targetId).scrollIntoView({
                behavior: 'smooth'
            });
        });
    });
});
</script>
{% endblock %}
